{"ts":1362558593061,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1362558610254,"patch":[[{"diffs":[[1,"<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\">\n\t<title>Bici</title>\n</head>\n<body onload=\"Gara()\">\t\n<canvas id=\"grafico\" width=\"1024\" height=\"640\"></canvas>\n\n\n<script type=\"text/javascript\" charset=\"utf-8\"> \n\nvar circonf_in_m = Math.PI * 0.50;\n\nfunction Bici(colore, imgsrc) {\n\tthis.arrivo = 0;\n\tthis.posizione_arrivo = new Image();\n\tthis.distanza = 62;\n\tthis.ultimo_sensore = -1;\n\tthis.ultimo_tempo = 0;\n\tthis.vel = [];\n\tthis.velmax = 0;\n\tthis.col = colore;\n\n\tthis.img = new Image();\n\tthis.img_it = 0;\n\tthis.img_it_end = 1;\n\tthis.img_loadnext = function () {\n\t\tif (++this.img_it > this.img_it_end) this.img_it = 1;\n//\t\tconsole.log(\"comunque non è giornata\");\n\t\tthis.img.src = imgsrc + this.img_it + \".jpg\";\n\t}\n\tthis.img_findnext = function () {\n\t\tthis.img_loadnext();\n\t\tif (this.img.complete) {\n\t\t\tthis.img_it_end++;\n\t\t\tthis.img.onload = this.img_findnext()\n\t\t} else {\n//\t\t\tconsole.log(\"Da non crederci\" + this.img_it + \" - \" + this.img_it_end);\n\t\t\tthis.img_it_end--;\n//\t\t\tthis.img_loadnext();\n\t\t}\n\t}\t\n\tthis.img.onload = this.img_findnext();\n\tthis.img_loadnext();\n\n\n\tthis.sensore1 = function () {\n\t\tif (this.arrivo == 0 && this.ultimo_sensore != 0) { this.ultimo_sensore = 0; this.addMezzoGiro_(); }\n\t}\n\n\tthis.sensore2 = function () {\n\t\tif (this.arrivo == 0 && this.ultimo_sensore != 1) { this.ultimo_sensore = 1; this.addMezzoGiro_(); }\n\t}\n\n\tthis.addMezzoGiro_ = function () {\n\t\tvar tempo = (new Date).getTime();\n\t\tif (this.ultimo_tempo) {\t\t\n\t\t\tvar mezzigiri_al_secondo = 500 / (tempo - this.ultimo_tempo);\n\t\t\tvar km_h = circonf_in_m * mezzigiri_al_secondo * 3.6;\n\t\t\tthis.vel.push(km_h);\n\t\t\tif (km_h > this.velmax) this.velmax = km_h;\n\t\t\tif (--this.distanza == 0) this.arrivo = tempo;\n\t\t}\n\t\tthis.ultimo_tempo = tempo;\t\t\n\t\t\n\t\tthis.img_loadnext();\n\t}\n}\n\nfunction Gara () {\n\tvar crono = (new Date).getTime();\n\tvar ctx = document.getElementById(\"grafico\").getContext(\"2d\");    \n\tvar bici = [];\n\tbici[0] = new Bici(\"blue\", \"scheletro\");\n\tbici[1] = new Bici(\"green\", \"moonanibike\");\n\tvar posizione = 1;\n\t\n\twindow.addEventListener('keydown', function(event) {\n\t\tif (event.keyCode == 37 /*Key.LEFT*/) bici[0].sensore1();\n\t\telse if (event.keyCode == 39 /*Key.RIGHT*/) bici[0].sensore2();\n\t\tif (event.keyCode == 38 /*Key.UP*/) bici[1].sensore1();\n\t\telse if (event.keyCode == 40 /*Key.DOWN*/) bici[1].sensore2();\n\t}, false);\n\t\n\tdraw();\t\n\t\n\tfunction draw () {\n\t\twindow.webkitRequestAnimationFrame(draw);\n\t\t\n\t\tvar tempo = (new Date).getTime();\n\n\t\tctx.clearRect(0, 0, 1024, 640);\n\n\t\tfor (var b = 0; b < bici.length; b++) {\t\t\n\t\t\tvar vel_att = ((tempo - bici[b].ultimo_tempo < 300) && bici[b].vel.length > 0) ? bici[b].vel[bici[b].vel.length - 1] : 0;\n\t\t\t\n\t\t\tctx.save();\n\t\t\tctx.translate(0,300*(b+1));\n\t\t\tctx.strokeStyle=bici[b].col;\n\t\t\t\n\t\t\tctx.beginPath();\n\t\t\tctx.lineJoin = \"round\";\n\t\t\tctx.lineWidth = 40;\n\t\t\tctx.fillStyle = bici[b].col;\n\t\t\tctx.moveTo(10*bici[b].vel.length + 20, -250);\n\t\t\tctx.lineTo(10*bici[b].vel.length + 170, - 250);\n\t\t\tctx.lineTo(10*bici[b].vel.length + 170, -226);\n\t\t\tctx.lineTo(10*bici[b].vel.length + 20, - 226);\n\t\t\tctx.closePath();\n\t\t\tctx.stroke();\n\t\t\tctx.fill();\n\t\t\t\t\t\t\n\t\t\tctx.font = \"30px San Serif\";\n\t\t\tctx.fillStyle = \"white\";\n\t\t\tctx.fillText(vel_att.toFixed(2) + \" km/h\", 10*bici[b].vel.length + 28, -230);\n\t\t\t\n\t\t\tctx.font = \"24px San Serif\";\n\t\t\tctx.fillStyle = bici[b].col;\n\t\t\tvar tempo_rif = tempo;\n\t\t\tif (bici[b].arrivo) {\n\t\t\t\ttempo_rif = bici[b].arrivo;\n\t\t\t\tif (bici[b].posizione_arrivo.src == \"\") bici[b].posizione_arrivo.src = \"arrivo\" + posizione++ + \".jpg\";\n\t\t\t}\n\t\t\tctx.fillText(\"Tempo: \" + ((tempo_rif - crono)/1000).toFixed(2) + \" sec\", 820, -70);\n\t\t\tctx.fillText(\"Max: \" + bici[b].velmax.toFixed(2) + \" km/h\", 820, -30);\n\t\t\tif (bici[b].posizione_arrivo.src != \"\") ctx.drawImage(bici[b].posizione_arrivo, 860, - 270);\n\t\t\t\n\t\t\tctx.drawImage(bici[b].img, 10*bici[b].vel.length, - 200);\n\t\t\t\n\t\t\tctx.beginPath();\t\t\t\n\t\t\tctx.lineWidth = 0.4;\t\t\t\n\t\t\tctx.moveTo(800, 0);\n\t\t\tctx.lineTo(0, 0);\t\t\t\n\t\t\tctx.scale(10, -4);\t\n\t\t\tfor (var i = 0; i < bici[b].vel.length; i++) {\n\t\t\t\tctx.lineTo(i, bici[b].vel[i]);\n\t\t\t}\n\t\t\tctx.stroke();\t\t\t\n\t\t\tctx.restore();\n\t\t}\n\t}\n}\n\n/*\nvar doctors = [\n  'rem', \n  'rich_clark', \n  'brucel', \n  'jackosborne', \n  'leads', \n  'akamike', \n  'boblet'];\nlocalStorage.doctors = JSON.stringify(doctors);\n\n// later that evening.\nvar html5docs = JSON.parse(localStorage.doctors);\nalert('There be ' + html5docs.length + ' doctors in the house');\n*/\n    \n</script>\n</body>\n</html>\n"]],"start1":0,"start2":0,"length1":0,"length2":4471}]],"length":4471,"saved":false}
{"ts":1362558663082,"patch":[[{"diffs":[[0," 1;\n"],[-1,"//\t\tconsole.log(\"comunque non è giornata\");\n"],[0,"\t\tth"]],"start1":672,"start2":672,"length1":52,"length2":8},{"diffs":[[0,"e {\n"],[-1,"//\t\t\tconsole.log(\"Da non crederci\" + this.img_it + \" - \" + this.img_it_end);\n"],[0,"\t\t\tt"]],"start1":882,"start2":882,"length1":85,"length2":8}]],"length":4350,"saved":false}
{"ts":1362558854200,"patch":[[{"diffs":[[0,";\n\t\t}\n\t}"],[-1,"\t"],[0,"\n\tthis.i"]],"start1":932,"start2":932,"length1":17,"length2":16}]],"length":4349,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362559178357,"patch":[[{"diffs":[[0,"\", \""],[-1,"scheletr"],[1,"biciun"],[0,"o\");"]],"start1":1855,"start2":1855,"length1":16,"length2":14},{"diffs":[[0,"\", \""],[-1,"moonanibik"],[1,"bicidu"],[0,"e\");"]],"start1":1896,"start2":1896,"length1":18,"length2":14}]],"length":4343,"saved":false}
{"ts":1362559472722,"patch":[[{"diffs":[[0,"e);\n"],[-1,"\t\n\tdraw();\t\n\t\n\tfunction draw () {\n\t\twindow.webkitRequestAnimation"],[1,"\n    window.requestAnimFrame = (function(){\n        return  window.requestAnimationFrame       ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame    ||\n                window.oRequestAnimationFrame      ||\n                window.msRequestAnimationFrame     ||\n                function( callback ){\n                    window.setTimeout(callback, 1000 / 60);\n                };\n    })();\n\n\n    return draw();\n    \n\tfunction draw () {\n\t\trequestAnim"],[0,"Fram"]],"start1":2244,"start2":2244,"length1":73,"length2":508}]],"length":4778,"saved":false}
{"ts":1362559628777,"patch":[[{"diffs":[[0,"t();\n\t\t}\n\t}\n"],[1,"//"],[0,"\tthis.img.on"]],"start1":929,"start2":929,"length1":24,"length2":26}]],"length":4780,"saved":false}
{"ts":1362559836554,"patch":[[{"diffs":[[0,"o;\t\t\n\t\t\n"],[1,"//"],[0,"\t\tthis.i"]],"start1":1657,"start2":1657,"length1":16,"length2":18}]],"length":4782,"saved":false}
